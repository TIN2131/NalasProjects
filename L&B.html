<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="Cache-Control" content="no-store" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Lexie & Abby Live Tracker ✨</title>
  <style>
    /* keep your existing CSS here – unchanged from my last version */
  </style>
</head>
<body>
  <!-- keep your existing markup here – unchanged from my last version -->
  <!-- ... header, cards, controls, etc. ... -->

  <!-- Notification -->
  <div class="notification" id="notification">
    <span class="notification-icon">✅</span>
    <span class="notification-text" id="notificationText">Entry added successfully!</span>
  </div>

  <script>
    // === CONFIG ===
    // IMPORTANT: This must be the Web App URL from Apps Script (the /exec link)
    const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzg2bu4zQIxXo5Pwk2qk1VQ2n3Gp3n_o3IyORhFFnji5J2n93KQo32D9W2fbbJaP5CzjQ/exec';

    // === (rest of JS identical to the last version I gave you) ===
    // The critical bit is the callApi() helper below (simple POST => no preflight)
    const sleep = (ms) => new Promise(r => setTimeout(r, ms));
    let activities=[], soundEnabled=true, adminMode=false, logExpanded=false, currentFilter='all', isLoading=false, isRefreshing=false, autoRefreshId=null, audioCtx=null;

    function escapeHtml(s){ return (s==null?'':String(s)).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#39;'); }
    const nowAmPm = (d=new Date()) => d.toLocaleTimeString('en-US',{hour:'numeric',minute:'2-digit',hour12:true});

    async function callApi(action, payload=null, { method='GET', timeout=10000, retries=1 } = {}){
      if (!navigator.onLine){ const e=new Error('OFFLINE'); e.code='OFFLINE'; throw e; }
      const controller = new AbortController();
      const url = `${GOOGLE_SCRIPT_URL}?action=${encodeURIComponent(action)}&t=${Date.now()}`;
      const options = { method, cache:'no-store', signal: controller.signal };
      if (method === 'POST'){
        options.headers = { 'Content-Type': 'text/plain;charset=utf-8' }; // simple request (no preflight)
        options.body = JSON.stringify(payload || {});
      }
      const timer = setTimeout(()=>controller.abort(), timeout);
      try{
        const res = await fetch(url, options);
        if (!res.ok) throw new Error(`HTTP_${res.status}`);
        return await res.json();
      }catch(err){
        if (retries>0){ await sleep(400); return callApi(action, payload, { method, timeout, retries: retries-1 }); }
        throw err;
      }finally{ clearTimeout(timer); }
    }

    // (the rest: init, UI handlers, quickAdd/addCustomEntry/refreshData/update displays)
    // Use the exact JS from the last message I sent—no changes needed except this callApi()

    // expose functions if needed for your buttons
    window.quickAdd = quickAdd;
    window.toggleAdminMode = toggleAdminMode;
    window.toggleSound = toggleSound;
    window.toggleLog = toggleLog;
    window.refreshData = refreshData;

    // Boot
    document.addEventListener('DOMContentLoaded', () => {
      // your existing DOMContentLoaded init from the last version
    });
  </script>
</body>
</html>
