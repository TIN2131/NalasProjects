<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NAICS 2022 Lookup Tool</title>
    <!-- SheetJS for parsing the official Excel file at runtime -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <style>
        :root {
            --primary: #2196f3;
            --primary-dark: #1976d2;
            --success: #2e7d32;
            --danger: #d32f2f;
            --bg: #f5f5f5;
            --panel-bg: #ffffff;
        }
        * { box-sizing: border-box; }
        body {
            margin: 0; padding: 20px;
            font-family: "Inter", Arial, sans-serif;
            background: var(--bg);
        }
        h1 { margin: 0 0 4px 0; font-size: 24px; color: #333; }
        .subtitle { margin: 0 0 16px 0; color: #666; font-size: 14px; }
        .container {
            max-width: 1400px; margin: 0 auto; background: var(--panel-bg);
            padding: 25px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,.1);
        }
        .header { display: flex; justify-content: space-between; align-items: flex-start; flex-wrap: wrap; }
        .selected-info { background:#e8f5e9; padding: 12px 16px; border-radius: 6px; min-width: 260px; }
        .selected-info h3 { margin: 0 0 8px 0; color: var(--success); font-size: 16px; }
        .button-row { display: flex; gap: 8px; flex-wrap: wrap; }
        .action-btn {
            border: none; border-radius: 4px; cursor: pointer; font-size: 13px;
            padding: 8px 14px; color: #fff; transition: background .2s;
        }
        .copy-btn { background: var(--success); }
        .copy-btn:hover { background: #1b5e20; }
        .clear-btn { background: var(--danger); }
        .clear-btn:hover { background: #b71c1c; }
        .main-layout { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; }
        .panel {
            border: 1px solid #e0e0e0; border-radius: 6px; height: 450px; overflow: hidden; position: relative;
            display: flex; flex-direction: column; background: var(--panel-bg);
        }
        .panel.middle { border: 2px solid var(--primary); background:#f0f8ff; }
        .panel-header {
            padding: 10px 15px; background: var(--primary); color:#fff; font-weight:600; font-size:14px;
            display:flex; align-items:center; gap:10px;
        }
        .panel-content { padding: 15px; overflow-y: auto; flex:1; }
        input[type="text"]{ width: 100%; padding: 10px; font-size: 14px; border:2px solid #ddd; border-radius:4px; }
        input[type="text"]:focus{ outline:none; border-color: var(--primary); }
        .category-grid{ display:grid; gap:8px; grid-template-columns: 1fr 1fr; }
        .category-btn{ padding:8px 12px; font-size:13px; background:#f8f8f8; border:1px solid #ddd; border-radius:4px; cursor:pointer; }
        .category-btn:hover{ background:#e8e8e8; }
        .result-item{ padding:10px; border:1px solid #ddd; border-radius:4px; margin-bottom:6px; font-size:13px; cursor:pointer; }
        .result-item:hover{ background:#f0f8ff; border-color: var(--primary); }
        .result-item.selected{ background:#e8f5e9; border:2px solid var(--success); }
        .code{ font-weight:600; color: var(--primary); margin-right:6px; }
        .no-results{ color:#666; text-align:center; padding:20px; }
        #loading{ position:fixed; inset:0; display:flex; align-items:center; justify-content:center; background:rgba(255,255,255,.8); font-size:18px; z-index:9999; }
        @media(max-width:900px){ .main-layout{ grid-template-columns:1fr; } }
    </style>
</head>
<body>
    <div id="loading">Loading NAICS data…</div>

    <div class="container" style="display:none" id="app">
        <div class="header">
            <div>
                <h1>NAICS Code Lookup Tool</h1>
                <p class="subtitle">North American Industry Classification System – 2022 Version</p>
            </div>
            <div class="selected-info" id="selectedInfo" style="display:none">
                <h3>Selected Code</h3>
                <div id="selectedDetails"></div>
                <div class="button-row">
                    <button class="action-btn copy-btn" id="copyBtn">Copy</button>
                    <button class="action-btn clear-btn" id="clearBtn">Clear</button>
                </div>
            </div>
        </div>

        <div class="main-layout">
            <!-- Categories -->
            <div class="panel" id="categoryPanel">
                <div class="panel-header">Browse by Sector</div>
                <div class="panel-content">
                    <p style="font-size:12px;color:#666;margin-top:0;">Don't know the code? Start here!</p>
                    <div class="category-grid" id="categoryGrid"></div>
                </div>
            </div>
            <!-- Search -->
            <div class="panel middle">
                <div class="panel-header">Search by Keyword or Code</div>
                <div class="panel-content">
                    <input type="text" id="searchInput" placeholder="Type keywords (e.g., lawyer, restaurant) or codes…" />
                    <div id="searchResults" style="margin-top:12px;"></div>
                </div>
            </div>
            <!-- Results -->
            <div class="panel">
                <div class="panel-header" id="resultsHeader">Results</div>
                <div class="panel-content" id="categoryResults">
                    <div class="no-results">Choose a sector or start typing to see matches.</div>
                </div>
            </div>
        </div>
    </div>

<script>
(()=>{
    // ======= CONFIG =======
    const EXCEL_URL = './2022_NAICS_Structure.xlsx';
    const STORAGE_KEY = 'naics2022';
    const sectorNames = {
        '11':'Agriculture, Forestry, Fishing & Hunting', '21':'Mining, Quarrying, Oil & Gas', '22':'Utilities', '23':'Construction',
        '31':'Manufacturing', '32':'Manufacturing', '33':'Manufacturing', '42':'Wholesale Trade',
        '44':'Retail Trade', '45':'Retail Trade', '48':'Transportation & Warehousing', '49':'Transportation & Warehousing',
        '51':'Information', '52':'Finance & Insurance', '53':'Real Estate & Leasing', '54':'Professional, Scientific & Technical',
        '55':'Management of Companies', '56':'Admin, Support & Waste Mgmt', '61':'Educational Services', '62':'Health Care & Social Assistance',
        '71':'Arts, Entertainment & Recreation', '72':'Accommodation & Food Services', '81':'Other Services', '92':'Public Administration'
    };

    // ======= STATE =======
    let naics = [], selected = null;

    // ======= DOM REFS =======
    const app = document.getElementById('app');
    const loadingScreen = document.getElementById('loading');
    const categoryGrid = document.getElementById('categoryGrid');
    const categoryResults = document.getElementById('categoryResults');
    const searchInput = document.getElementById('searchInput');
    const searchResults = document.getElementById('searchResults');
    const resultsHeader = document.getElementById('resultsHeader');
    const selectedInfo = document.getElementById('selectedInfo');
    const selectedDetails = document.getElementById('selectedDetails');
    const copyBtn = document.getElementById('copyBtn');
    const clearBtn = document.getElementById('clearBtn');

    // ======= HELPERS =======
    const debounce=(fn,ms=300)=>{let t;return(...a)=>{clearTimeout(t);t=setTimeout(()=>fn.apply(this,a),ms)}};
    const renderCodeItem=(item)=>`<span class="code">${item.code}</span>${item.description}`;

    // ======= LOAD DATA =======
    async function loadData(){
        // cache first
        const cached = localStorage.getItem(STORAGE_KEY);
        if(cached){ naics = JSON.parse(cached); return; }
        try{
            const ab = await fetch(EXCEL_URL).then(r=>r.arrayBuffer());
            const wb = XLSX.read(ab,{type:'array'});
            const sheet = wb.Sheets[wb.SheetNames[0]];
            const rows = XLSX.utils.sheet_to_json(sheet,{header:1});
            naics = rows
                .filter(r=>/^[0-9]{6}$/.test(r[0]))
                .map(r=>({code:String(r[0]),description:r[1]}));
            localStorage.setItem(STORAGE_KEY, JSON.stringify(naics));
        }catch(e){
            console.error('Failed to fetch NAICS file',e);
            alert('Could not download NAICS list automatically. Falling back to a limited in‑memory list. Download 2022_NAICS_Structure.xlsx and place it next to this file for full functionality.');
            naics = [
                {code:'541211',description:'Offices of Certified Public Accountants'},
                {code:'541110',description:'Offices of Lawyers'},
                {code:'531210',description:'Offices of Real Estate Agents and Brokers'},
                {code:'621111',description:'Offices of Physicians (except Mental Health Specialists)'},
                {code:'236220',description:'Commercial and Institutional Building Construction'}];
        }
    }

    // ======= UI BUILDERS =======
    function buildSectorButtons(){
        // unique 2‑digit prefixes present in data
        const prefixes = [...new Set(naics.map(n=>n.code.slice(0,2)))].sort();
        prefixes.forEach(pref=>{
            const btn=document.createElement('button');
            btn.className='category-btn';
            btn.textContent=sectorNames[pref]||`Sector ${pref}`;
            btn.dataset.prefix=pref;
            categoryGrid.appendChild(btn);
        });
    }

    function listToContainer(list,target){
        target.innerHTML='';
        if(!list.length){ target.innerHTML='<div class="no-results">No results found.</div>'; return; }
        list.forEach(item=>{
            const div=document.createElement('div');
            div.className='result-item';
            if(selected && selected.code===item.code) div.classList.add('selected');
            div.innerHTML = renderCodeItem(item);
            div.onclick=()=>select(item);
            target.appendChild(div);
        });
    }

    // ======= INTERACTIONS =======
    function select(item){
        selected = item;
        document.querySelectorAll('.result-item').forEach(el=>el.classList.remove('selected'));
        [...searchResults.children, ...categoryResults.children].forEach(el=>{
            if(el.innerText.startsWith(item.code)) el.classList.add('selected');
        });
        selectedDetails.textContent=`${item.code} – ${item.description}`;
        selectedInfo.style.display='block';
    }

    copyBtn.addEventListener('click',()=>{
        if(!selected) return;
        navigator.clipboard.writeText(`${selected.code} - ${selected.description}`).then(()=>alert('Copied to clipboard!'));
    });
    clearBtn.addEventListener('click',()=>{
        selected=null;selectedInfo.style.display='none';
        document.querySelectorAll('.result-item').forEach(el=>el.classList.remove('selected'));
    });

    categoryGrid.addEventListener('click',e=>{
        const btn=e.target.closest('.category-btn');
        if(!btn) return;
        const prefix=btn.dataset.prefix;
        const matches = naics.filter(n=>n.code.startsWith(prefix));
        resultsHeader.textContent = sectorNames[prefix]||`Sector ${prefix}`;
        listToContainer(matches,categoryResults);
    });

    searchInput.addEventListener('input',debounce(e=>{
        const q=e.target.value.trim().toLowerCase();
        if(q.length<3){ searchResults.innerHTML=''; return; }
        const matches = naics.filter(n=> n.description.toLowerCase().includes(q) || n.code.startsWith(q));
        listToContainer(matches,searchResults);
    },250));

    // ======= INIT =======
    (async ()=>{
        await loadData();
        buildSectorButtons();
        loadingScreen.style.display='none';
        app.style.display='block';
    })();
})();
</script>
</body>
</html>
